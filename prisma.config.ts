// This file was generated by Prisma and assumes you have installed the following:
// npm install --save-dev prisma dotenv
import * as dotenv from "dotenv";
import { defineConfig, env } from "prisma/config";

// Load .env.local first (local dev), then .env as fallback
dotenv.config({ path: ".env.local" });
dotenv.config({ path: ".env" });

// For migrations, Prisma needs a direct connection (not pooler)
const directUrl = env("DIRECT_URL");
const poolerUrl = env("DATABASE_URL");

// Supabase session mode pooler URL for schema operations
// Use port 5432 instead of 6543 for session mode (supports DDL)
const sessionPoolerUrl = poolerUrl?.replace(":6543/", ":5432/").replace("?pgbouncer=true", "");

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  datasource: {
    // Use session mode pooler - port 5432 direct is often blocked locally
    url: sessionPoolerUrl || poolerUrl,
  },
});
